<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="./../xmlrpc.php">

<title>Storing the state of a Long Running Process &#8211; Simple Oriented Architecture</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//stats.wp.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//v0.wordpress.com">
<link rel="dns-prefetch" href="//i0.wp.com">
<link rel="alternate" type="application/rss+xml" title="Simple Oriented Architecture &raquo; Feed" href="./../feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Simple Oriented Architecture &raquo; Comments Feed" href="./../comments/feed/index.html">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":".\/\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🐦‍⬛","🐦​⬛")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="./../wp-content/plugins/jetpack/modules/related-posts/related-posts.css?ver=20240116" type="text/css" media="all">
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="./../wp-includes/css/dist/block-library/style.min.css?ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="mediaelement-css" href="./../wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./../wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.6.2" type="text/css" media="all">
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}</style>
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="bulan-plugins-style-css" href="./../wp-content/themes/bulan/assets/css/plugins.min.css?ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="bulan-fonts-css" href="https://fonts.googleapis.com/css?family=Crimson+Text%3A400%2C700%2C400italic%257COswald%3A400%2C700%2C300&#038;subset=latin%2Clatin-ext&#038;ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="bulan-style-css" href="./../wp-content/themes/bulan/style.min.css?ver=6.6.2" type="text/css" media="all">
<script type="text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="text/javascript" src="./../wp-content/plugins/jetpack/_inc/build/related-posts/related-posts.min.js?ver=20240116" id="jetpack_related-posts-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<!--[if lte IE 9]>
<script type="text/javascript" src=".//wp-content/themes/bulan/assets/js/html5shiv.min.js" id="standard-html5-js"></script>
<![endif]-->
<link rel="https://api.w.org/" href="./../wp-json/index.html">
<link rel="alternate" title="JSON" type="application/json" href="./../wp-json/wp/v2/posts/907/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.6.2">
<link rel="canonical" href="./index.html">
<link rel="shortlink" href="https://wp.me/p7kV6P-eD">
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="./../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Fstoring-the-state-of-a-long-running-process%2F">
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="./../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Fstoring-the-state-of-a-long-running-process%2F#038;format=xml">
	<style>img#wpstats{display:none}</style>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="Storing the state of a Long Running Process">
<meta property="og:url" content="./index.html">
<meta property="og:description" content="In the previous two posts in this series, we&#8217;ve seen some examples of long running processes and how to model them. In this article we&#8217;ll see where to store the state of a long running …">
<meta property="article:published_time" content="2018-07-04T04:20:18+00:00">
<meta property="article:modified_time" content="2024-11-08T09:33:10+00:00">
<meta property="og:site_name" content="Simple Oriented Architecture">
<meta property="og:image" content="./../wp-content/uploads/2018/06/Example_OrderFulfillment_small.jpg">
<meta property="og:image:width" content="500">
<meta property="og:image:height" content="213">
<meta property="og:image:alt" content="Order Fulfillment">
<meta property="og:locale" content="en_US">
<meta name="twitter:site" content="@victorchircu">
<meta name="twitter:text:title" content="Storing the state of a Long Running Process">
<meta name="twitter:image" content="./../wp-content/uploads/2018/06/Example_OrderFulfillment_small.jpg?w=640">
<meta name="twitter:image:alt" content="Order Fulfillment">
<meta name="twitter:card" content="summary_large_image">

<!-- End Jetpack Open Graph Tags -->
</head>

<body class="post-template-default single single-post postid-907 single-format-standard no-custom-header no-featured-image layout-2c-l" itemscope itemtype="http://schema.org/Blog">

<div id="page" class="site">

	<div class="search-area">
		<div class="wide-container">
			<form role="search" method="get" class="searchform" action=".//">
	<div>
		<input type="search" class="search-field field" placeholder="Press enter to search &hellip;" value="" name="s" title="Search for:">
	</div>
</form>
		</div>
	</div>

	
	<header id="masthead" class="site-header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">

		<div class="site-branding">
			<div class="wide-container">
				<div id="logo">
<h1 class="site-title" itemprop="headline"><a href="./../index.html" itemprop="url" rel="home"><span itemprop="headline">Simple Oriented Architecture</span></a></h1>
</div>
			</div>
		</div>

	</header><!-- #masthead -->

	<div id="content" class="site-content">
		<div class="wide-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main">

			
				<article id="post-907" class="post-907 post type-post status-publish format-standard hentry category-architecture category-nservicebus tag-integration tag-long-running-process tag-messaging tag-microservices tag-nservicebus tag-process-manager tag-routing-slip tag-soa no-post-thumbnail no-sticky entry" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">

	<header class="entry-header">

								<span class="cat-links" itemprop="articleSection">
				<a href="./../category/architecture/index.html" rel="category tag">Architecture</a>, <a href="./../category/nservicebus/index.html" rel="category tag">NServiceBus</a>			</span>
			<i class="fa fa-circle"></i>
					
					<time class="published" datetime="2018-07-04T04:20:18+00:00" itemprop="datePublished">July 4, 2018</time>
		
		<h1 class="entry-title" itemprop="headline">Storing the state of a Long Running Process</h1>
	</header><!-- .entry-header -->

	
	<div class="entry-content" itemprop="articleBody">

		<p>In the previous two posts in this series, we&#8217;ve seen <a href="./../what-are-long-running-processes/index.html" target="_blank" rel="noopener">some examples of long running processes</a> and <a href="./../modelling-long-running-processes-choreography-versus-orchestration/index.html" target="_blank" rel="noopener">how to model</a> them. In this article we&#8217;ll see where to store the state of a long running process. This is an important topic when talking about long running processes because long running means stateful. We&#8217;ll discuss three patterns: storing the state in the domain entity, in the message or in a process instance. To better explain these patterns, we&#8217;ll implement subflows from the Order Fulfillment enterprise process.</p>
<p><img data-recalc-dims="1" fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-863" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/06/Example_OrderFulfillment_small.jpg?resize=500%2C213" alt="Order Fulfillment" width="500" height="213"></p>
<p>You can find the code on <a href="https://github.com/vchircu/LongRunningProcesses" target="_blank" rel="noopener">my GitHub account</a>.</p>
<h2>Store the state in the Domain Entity</h2>
<p>This is probably the most used approach of the three, although it&#8217;s not the best choice in most cases. But it&#8217;s overused because it&#8217;s simple: you just store the state in the domain entity.</p>
<h3>Requirement</h3>
<p>Let&#8217;s start with what <strong>Finance</strong> needs to do when it receives the <strong>OrderPlaced</strong> event: charge the customer. To do that, it will integrate with a 3rd party payment provider. The long running process in this case handles two message:</p>
<ul>
<li>the <strong>OrderPlaced</strong> event &#8211; in which case it will send a <strong>ChargeCreditCardRequest</strong>
</li>
<li>the <strong>ChargeCreditCardRespone</strong>
</li>
</ul>
<h3>Implementation</h3>
<p>Since we only have two transitions, we could store the state in the Order entity.</p>
<p><img data-recalc-dims="1" decoding="async" class="aligncenter size-full wp-image-927" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/Entities_Example_small.png?resize=600%2C326" alt="Entities Example" width="600" height="326"></p>
<p>Let&#8217;s have a look at the code. We&#8217;ll use <a href="https://particular.net/nservicebus" target="_blank" rel="noopener">NServiceBus</a>, but the code is readable even if you don&#8217;t know NServiceBus or .Net.</p>
<p><span id="more-907"></span></p>
<p>This is the OrderPlacedHandler:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public Task Handle(IOrderPlaced message, IMessageHandlerContext context)
{
	var order = new Order(message.OrderId, message.TotalValue);
	order.Status = OrderStatus.Pending;

	orders.Save(order);

	context.Send(new ChargeCreditCardRequest { CorrelationId = message.OrderId, Amount = message.TotalValue });

	return Task.CompletedTask;
}
</pre>
<p>We save the order with a Pending status and send a <strong>ChargeCreditCardRequest</strong>.</p>
<p>This is what happens when we get a response back:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public Task Handle(ChargeCreditCardResponse message, IMessageHandlerContext context)
{
	var order = orders.GetById(message.CorrelationId);

	order.Status = message.CardHasBeenCharged ? OrderStatus.Paid : OrderStatus.PaymentFailed;

	Log.Info($&amp;quot;Payment Status for Order with Id {order.OrderId} is {order.Status}&amp;quot;);

	orders.Save(order);

	if (order.Status == OrderStatus.Paid)
	{
		context.Publish&amp;lt;IOrderCharged&amp;gt;(orderCharged =&amp;gt; { orderCharged.OrderId = order.OrderId; });
	}

	return Task.CompletedTask;
}
</pre>
<h3>Benefits</h3>
<h4>Easy</h4>
<p>This is easy to do. We don&#8217;t need any new framework or library.</p>
<h3>Drawbacks</h3>
<h4>Breaks the <a href="https://8thlight.com/blog/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html" target="_blank" rel="noopener">Single Responsibility Principle</a>
</h4>
<pre class="brush: csharp; title: ; notranslate" title="">
public class Order
{
	public Order(Guid orderId, decimal totalValue)
	{
		this.OrderId = orderId;
		this.TotalValue = totalValue;
	}

	public decimal TotalValue { get; }

	// Process Logic
	public OrderStatus Status { get; set; }

	public Guid OrderId { get; }

	// Business Logic
	public void Cancel(DateTime cancellationDate) { }

	public void ApplyDiscount(DiscountCode discountCode) { }
}
</pre>
<p>The Order entity can now change for two different reasons: a change in the business rules or a change in the process.</p>
<h4>Limited flexibility</h4>
<p>The problem with many simple processes is that they don&#8217;t stay simple for long. Here are two examples:</p>
<ul>
<li>
<strong>Cancelling old pending orders</strong>. Let&#8217;s say that the business comes with a new requirement. We should cancel all pending orders that are older than 30 minutes. How would you implement that? Without the right tool (like <a style="background-color: #ffffff;" href="https://docs.particular.net/nservicebus/sagas/timeouts" target="_blank" rel="noopener">NServiceBus&#8217; timeout</a>) you would probably introduce a batch job. This would periodically query the database for pending orders older than 30 minutes and cancel them. The problem is that now you&#8217;ve broken the encapsulation of the Order class because you&#8217;ve put business logic in the batch job. <a style="background-color: #ffffff;" href="https://particular.net/blog/death-to-the-batch-job" target="_blank" rel="noopener">Batch jobs are usually a code smell and should be avoided</a>.</li>
<li>Another example is if we decide to <strong>first validate the charge and then charge the customer&#8217;s credit card</strong>. A two step process has quickly become a three step process.</li>
</ul>
<h3>Tips</h3>
<p>You should use this approach only when the process has a couple of steps. Even then, I would think twice. Event if it&#8217;s simple now, it might become more complex soon.</p>
<h2>Store the state in the Message</h2>
<p>As we mentioned earlier, we actually want to validate the charge before charging the customer. Let&#8217;s have a look at the requirement.</p>
<h3>Requirement</h3>
<p>Imagine that we have three credit card validators throughout our organization. One is free, one is expensive and one is a very expensive fraud detection algorithm. Considering that validating credit card charges cost money, the business wants to minimize this cost. To do this, we want to always first pass the charge through the Free Credit Card Validation. If a charge is larger than 500$, we also want to use the Expensive Credit Card Validator. If it&#8217;s larger than 2000$, then we also want to use the Very Expensive Fraud Detection Algorithm. Basically, we want to pass through a series of validation steps depending on the order value.</p>
<p><img data-recalc-dims="1" decoding="async" class="aligncenter size-full wp-image-932" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/RoutingSlip_Requirement_small.png?resize=600%2C351" alt="Routing Slip - Requirement" width="600" height="351"></p>
<h3>Pattern</h3>
<p>Luckily, the<a href="./../book-review-enterprise-integration-patterns/index.html" target="_blank" rel="noopener"><em> Enterprise Integration Patterns</em> book</a>, describes a pattern that is a good fit in this situation: the <a href="http://www.enterpriseintegrationpatterns.com/patterns/messaging/RoutingTable.html" target="_blank" rel="noopener">Routing Slip</a>.</p>
<blockquote><p>How do we route a message consecutively through a series of processing steps when the sequence of steps is not known at design-time and may vary for each message?</p></blockquote>
<figure id="attachment_925" aria-describedby="caption-attachment-925" style="width: 429px" class="wp-caption aligncenter"><img data-recalc-dims="1" loading="lazy" decoding="async" class="wp-image-925 size-full" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/RoutingTableSimple.png?resize=429%2C197" alt="Routing Slip" width="429" height="197"><figcaption id="caption-attachment-925" class="wp-caption-text">Source: http://www.enterpriseintegrationpatterns.com/patterns/messaging/RoutingTable.html</figcaption></figure>
<blockquote><p>Attach a Routing Slip to each message, specifying the sequence of processing steps. Wrap each<br>
component with a special message router that reads the Routing Slip and routes the message to<br>
the next component in the list.</p></blockquote>
<h3>Implementation</h3>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" class="aligncenter size-full wp-image-928" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/RoutingSlip_Example_small.png?resize=628%2C227" alt="Routing Slip Example" width="628" height="227" srcset="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/RoutingSlip_Example_small.png?w=900&amp;ssl=1 900w, https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/RoutingSlip_Example_small.png?resize=768%2C277&amp;ssl=1 768w" sizes="(max-width: 628px) 100vw, 628px"></p>
<p>This is how we would use the Routing Slip pattern in our case. The <strong>OrderPlacedHandler</strong> would compute the routing slip and attach it to the <strong>ValidateCreditCardCharge</strong> message. The routing slip infrastructure would take care of routing this message to the correct endpoints.</p>
<p>Let&#8217;s dive deeper into the code.</p>
<p>The <strong>OrderPlacedHandler</strong> computes the routing slip for the message and then routes the message. (NServiceBus doesn&#8217;t support routing slips out of the box. You need to use the <a href="https://docs.particular.net/samples/routing-slips/" target="_blank" rel="noopener">RoutingSlip NuGet package</a>)</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public Task Handle(IOrderPlaced message, IMessageHandlerContext context)
{
	Log.Info($&amp;quot;Order with Id {message.OrderId} placed. Validating...&amp;quot;);

	var order = new Order(message.OrderId, message.TotalValue);
	order.Status = OrderStatus.Validating;

	orders.Save(order);

	var validateCreditCardCharge =
		new ValidateCreditCardCharge { Amount = message.TotalValue, CorrelationId = order.OrderId };

	List&amp;lt;string&amp;gt; destinations = GetDestinationsFor(validateCreditCardCharge);
	context.Route(validateCreditCardCharge, order.OrderId, destinations.ToArray());

	return Task.CompletedTask;
}
</pre>
<p>The <strong>GetDestinationsFor</strong> method computes the routing slips based on the order&#8217;s total amount. This adds all the required validators. At the end, it also adds the Finance Endpoint, which will act as the results aggregator.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
private static List&amp;lt;string&amp;gt; GetDestinationsFor(ValidateCreditCardCharge validateCreditCardCharge)
{
	var destinations = new List&amp;lt;string&amp;gt; { &amp;quot;ItOps.FreeCreditCardValidator.Endpoint&amp;quot; };
	if (validateCreditCardCharge.Amount &amp;gt; 500)
	{
		destinations.Add(&amp;quot;ItOps.ExpensiveCreditCardValidator.Endpoint&amp;quot;);
	}

	if (validateCreditCardCharge.Amount &amp;gt; 2000)
	{
		destinations.Add(&amp;quot;ItOps.VeryExpensiveFraudDetection.Endpoint&amp;quot;);
	}

	destinations.Add(&amp;quot;Finance.Endpoint&amp;quot;);
	return destinations;
}
</pre>
<p>Let&#8217;s see how will the <strong>ExpensiveCreditCardValidator</strong> handle this message:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public Task Handle(ValidateCreditCardCharge message, IMessageHandlerContext context)
{
	Log.Info($&amp;quot;Validating Credit Card Charge with Id {message.CorrelationId} is expensive!&amp;quot;);

	if (!IsValid(message))
	{
		var routingSlip = context.Extensions.Get&amp;lt;RoutingSlip&amp;gt;();
		routingSlip.Attachments&#x5B;&amp;quot;ExpensiveCreditCardValidator.ValidationError&amp;quot;] = &amp;quot;ExpensiveCreditCardValidator found an issue with the charge&amp;quot;;
		routingSlip.RouteToLastStep();
	}

	return Task.CompletedTask;
}
</pre>
<p>If the charge is not valid, then we add an attachment to the routing slip, in order to inform the results aggregator. We also short circuit the process and route the message to the last step. If the charge is valid, we don&#8217;t do anything. We simply let the router do its job.</p>
<p>As we said, the Finance.Endpoint is the results aggregator. When it handles the <strong>ValidateCreditCardCharge </strong>message, it inspects the routing slip and makes decisions based on its attachments.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public Task Handle(ValidateCreditCardCharge message, IMessageHandlerContext context)
{
	var routingSlip = context.Extensions.Get&amp;lt;RoutingSlip&amp;gt;();
	var order = orders.GetById(message.CorrelationId);

	if (routingSlip.Attachments.Any())
	{
		order.Status = OrderStatus.ValidationFailed;
		LogResponse(routingSlip.Attachments, order.OrderId);
	}
	else
	{
		order.Status = OrderStatus.Pending;
		context.Send(new ChargeCreditCardRequest { CorrelationId = order.OrderId, Amount = order.TotalValue });
	}

	orders.Save(order);

	return Task.CompletedTask;
}
</pre>
<h3>Benefits</h3>
<h4>No bottlenecks</h4>
<p>One of the main advantages of the routing slips is that it doesn&#8217;t introduce any bottlenecks. <a href="https://jimmybogard.com/" target="_blank" rel="noopener">Jimmy Bogard</a> has a good presentation on <a href="https://fast.wistia.net/embed/iframe/y56svovwnk" target="_blank" rel="noopener">how he used the Routing Slip pattern to perform search database enrichment</a>. (The routing slip part starts at the 12:30 minute mark).</p>
<h4>Easy to change</h4>
<p>Not only that there isn&#8217;t a bottleneck, but the routing logic is also in a single place. This makes it easier to understand and change. If you want to add a new validator or change the validation rules, you only need to update the <strong>OrderPlacedHandler</strong>.</p>
<h4>Low coupling</h4>
<p>The components in this design are loosely coupled. The validation steps don&#8217;t know about each other. This makes it easy to update the validation process without changing the existing steps.</p>
<h3>Drawbacks</h3>
<h4>Harder to monitor</h4>
<p>The downside of this solution is that it&#8217;s harder to debug and monitor. If you want to know the validation status for an order, you actually have take a look at the message. The message headers will contain the itinerary (where has the message been and where it will go next) and any attachments.</p>
<h3>Tips</h3>
<p>Although it doesn&#8217;t have many downsides, the routing slip pattern has a big limitation: you can use this solution only if<strong> the process steps can be determined upfront for each message and the process is sequential</strong>. This means that steps cannot depend on intermediate results. <strong>Use Routing Slips when the process steps can be determined upfront for each message</strong>. But, in many cases, you need to know what messages were received in order to decide what to do next. Or the process isn&#8217;t sequential (it contains some parallel steps). In these cases, the Process Manager pattern could help. Let&#8217;s see how.</p>
<h2>Store the state in a Process Instance</h2>
<p>The third approach is to store the state in a process instance. Let&#8217;s have a look at our shipping policy to see why would we need this.</p>
<h3>Requirement</h3>
<p>Business people had a look at different shipping providers and came up with the following shipping policy:</p>
<ul>
<li>First, attempt to ship with Fan Courier.</li>
<li>If cannot ship with Fan Courier, attempt to ship with Urgent Cargus.</li>
<li>If we did not receive a response from Fan Courier within the agreed SLA, cancel the Fan Courier shipment and attempt to ship with Urgent Cargus.</li>
<li>If we cannot ship with Urgent Cargus or did not receive a response within the agreed SLA, notify the IT department.</li>
</ul>
<h3>Pattern</h3>
<p><em><a href="./../book-review-enterprise-integration-patterns/index.html" target="_blank" rel="noopener">Enterprise Integration Patterns</a>  </em>are here to help!  The Process Manager pattern points us in the right direction.</p>
<blockquote><p>How do we route a message through multiple processing steps when the required steps may not be known at design-time and may not be sequential?</p></blockquote>
<figure id="attachment_926" aria-describedby="caption-attachment-926" style="width: 315px" class="wp-caption aligncenter"><a href="http://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html"><img data-recalc-dims="1" loading="lazy" decoding="async" class="size-full wp-image-926" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/ProcessManager.png?resize=315%2C157" alt="Process Manager" width="315" height="157"></a><figcaption id="caption-attachment-926" class="wp-caption-text">source: http://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html</figcaption></figure>
<blockquote><p>Use a central processing unit, a Process Manager, to maintain the state of the sequence and determine the next processing step based on intermediate results.</p></blockquote>
<p>The Process Manager can be just another type of entity (although I don&#8217;t recommend implementing it yourself). Or you could use a framework. <a href="https://docs.particular.net/nservicebus/sagas/" target="_blank" rel="noopener">NServiceBus</a> and <a href="http://masstransit-project.com/MassTransit/advanced/sagas/" target="_blank" rel="noopener">MassTransit</a> have the Saga construct. Another option is to use a lightweight workflow engine, like <a href="https://camunda.com/" target="_blank" rel="noopener">Camunda</a>.</p>
<h3>Implementation</h3>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" class="aligncenter size-full wp-image-929" src="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/ProcessManager_Example_small.png?resize=628%2C675" alt="Process Manager Example" width="628" height="675" srcset="https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/ProcessManager_Example_small.png?w=900&amp;ssl=1 900w, https://i0.wp.com/www.simpleorientedarchitecture.com/wp-content/uploads/2018/07/ProcessManager_Example_small.png?resize=768%2C825&amp;ssl=1 768w" sizes="(max-width: 628px) 100vw, 628px"></p>
<p>Let&#8217;s see the state for a process instance:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public class ShipOrderProcessData : IContainSagaData
{
	public Guid Id { get; set; }

	public string Originator { get; set; }

	public string OriginalMessageId { get; set; }

	public Guid OrderId { get; set; }

	public ShippingStatus Status { get; set; }
}

public enum ShippingStatus
{
	ShippingWithUrgentCargus,

	ShippingWithFanCourier
}
</pre>
<p>The first three properties are required by NServiceBus. They represent the Id of the long running process, the Id of the message that started the process and the endpoint that sent this message. The last two represent our custom state: the order id and a shipping status.</p>
<p>Now let&#8217;s look at the behavior of the long running process.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public class ShipOrderProcessManager : Saga&amp;lt;ShipOrderProcessData&amp;gt;,
									  IAmStartedByMessages&amp;lt;ShipOrder&amp;gt;,
									  IHandleMessages&amp;lt;ShipWithFanCourierResponse&amp;gt;,
									  IHandleMessages&amp;lt;ShipWithUrgentCargusResponse&amp;gt;,
									  IHandleTimeouts&amp;lt;DidNotReceiveAResponseFromFanCourierTimeout&amp;gt;,
									  IHandleTimeouts&amp;lt;DidNotReceiveAResponseFromUrgentCargusTimeout&amp;gt;
{
	private static readonly ILog Log = LogManager.GetLogger(typeof(ShipOrderProcessManager));

	private readonly TimeSpan shipmentSla = TimeSpan.FromSeconds(10);

	public Task Handle(ShipOrder message, IMessageHandlerContext context)
	{
		Log.Info($&amp;quot;Received ShipOrder command for Order with Id {message.OrderId}.&amp;quot;);
		Log.Info($&amp;quot;Attempting to ship Order with Id {Data.OrderId} with FanCourier.&amp;quot;);

		Data.OrderId = message.OrderId;
		Data.Status = ShippingStatus.ShippingWithFanCourier;

		context.Send(new ShipWithFanCourierRequest { CorrelationId = Data.OrderId });

		RequestTimeout(context, shipmentSla, new DidNotReceiveAResponseFromFanCourierTimeout());

		return Task.CompletedTask;
	}

	public Task Handle(ShipWithFanCourierResponse message, IMessageHandlerContext context)
	{
		if (message.PackageShipped)
		{
			if (Data.Status == ShippingStatus.ShippingWithFanCourier)
			{
				context.Publish&amp;lt;IOrderShipped&amp;gt;(m =&amp;gt; { m.OrderId = Data.OrderId; });

				// Mark the process as complete. 
				// This will remove the process instance from the data store.
				MarkAsComplete();

				Log.Info($&amp;quot;Done shipping Order with Id {Data.OrderId}.&amp;quot;);
			}
		}
		else
		{
			ShipWithUrgentCargus(context);
		}

		return Task.CompletedTask;
	}

	public Task Handle(ShipWithUrgentCargusResponse message, IMessageHandlerContext context)
	{
		if (message.PackageShipped)
		{
			context.Publish&amp;lt;IOrderShipped&amp;gt;(m =&amp;gt; { m.OrderId = Data.OrderId; });
			MarkAsComplete();

			Log.Info($&amp;quot;Done shipping Order with Id {Data.OrderId}.&amp;quot;);
		}
		else
		{
			throw new CannotShipOrderException(Data.OrderId);
		}

		return Task.CompletedTask;
	}

	public Task Timeout(DidNotReceiveAResponseFromFanCourierTimeout state, IMessageHandlerContext context)
	{
		if (Data.Status == ShippingStatus.ShippingWithFanCourier)
		{
			context.Send(new CancelFanCourierShipping { CorrelationId = Data.OrderId });
			ShipWithUrgentCargus(context);
		}

		return Task.CompletedTask;
	}

	public Task Timeout(DidNotReceiveAResponseFromUrgentCargusTimeout state, IMessageHandlerContext context)
	{
		throw new CannotShipOrderException(Data.OrderId);
	}

	protected override void ConfigureHowToFindSaga(SagaPropertyMapper&amp;lt;ShipOrderProcessData&amp;gt; mapper)
	{
		mapper.ConfigureMapping&amp;lt;ShipOrder&amp;gt;(message =&amp;gt; message.OrderId).ToSaga(sagaData =&amp;gt; sagaData.OrderId);
	}

	private void ShipWithUrgentCargus(IMessageHandlerContext context)
	{
		Log.Info($&amp;quot;Attempting to ship Order with Id {Data.OrderId} with UrgentCargus.&amp;quot;);

		Data.Status = ShippingStatus.ShippingWithUrgentCargus;
		context.Send(new ShipWithUrgentCargusRequest { CorrelationId = Data.OrderId });

		RequestTimeout(context, shipmentSla, new DidNotReceiveAResponseFromUrgentCargusTimeout());
	}
}
</pre>
<h3>Benefits</h3>
<h4>Can handle complex flows</h4>
<p>The Process Manager pattern is very flexible. You can probably use it to implement any long running process, no matter how complex. Even if you can, that doesn&#8217;t mean you should, because it has its own drawbacks. But it&#8217;s a very good tool in the toolbox.</p>
<h4>Easy to change</h4>
<p>This implementation is easy to understand and change, because the logic in in a single place.</p>
<h3>Good encapsulation</h3>
<p>The ShipOrderProcessManager contains the entire shipping policy. Its data (the ShipOrderProcessData) is private to the process manager. Its behavior is exposed through the messages that it can handle. This keeps the data and the behavior in a single place and you don&#8217;t need to add batch jobs.</p>
<h3>Drawbacks</h3>
<h4>&#8220;God&#8221; class</h4>
<p>Because the Process Manager is easy to understand, we can abuse it and put too much logic in it. We must make sure that it adheres to the Single Responsibility Principle, so it doesn&#8217;t become a &#8220;God&#8221; class. A Process Manager implementation can grow and you&#8217;ll need to refactor it. Just like any other class.</p>
<h3>Performance bottleneck</h3>
<p>Because the Process Manager determines the next step in the sequence, it needs to handle all response messages. This can become a bottleneck. Jimmy Bogard has a good article on <a href="https://lostechies.com/jimmybogard/2014/02/27/reducing-nservicebus-saga-load/" target="_blank" rel="noopener">reducing the load on a Process Manager</a>.</p>
<h3>Tips</h3>
<ul>
<li>Use a Process Manager when the process changes based on intermediate results.</li>
<li>Use a Process Manager when the process is complex. This pattern can handle complexity really well.</li>
</ul>
<h3>Other Examples</h3>
<p>In the <a href="https://github.com/vchircu/LongRunningProcesses" target="_blank" rel="noopener">accompanying code</a>, we have used this pattern in several places. For example:</p>
<ul>
<li>
<a href="https://github.com/vchircu/LongRunningProcesses/blob/master/MyShop/MyShop.Sales.Endpoint/PlaceOrderPolicy.cs" target="_blank" rel="noopener">PlaceOrderPolicy</a> &#8211; to consider buyer&#8217;s remorse before placing an order.</li>
<li>
<a href="https://github.com/vchircu/LongRunningProcesses/blob/master/MyShop/MyShop.Shipping.Endpoint/OrderEventsAggregator.cs" target="_blank" rel="noopener">OrderEventsAggregator</a> &#8211; to do <a href="https://blog.bernd-ruecker.com/event-command-transformation-in-microservice-architectures-and-ddd-dd07d5eb9656" target="_blank" rel="noopener">event command transformation</a>.  It will wait for both IOrderPacked and IOrderCharged events and then send either the ShipOrder or ShipHighVolumeOrder command, based on the type of the order.</li>
</ul>
<h2>Conclusion</h2>
<p>This article presented three strategies for storing the state of a long running process. I personally find myself using the Process Manager most often. The routing slip pattern, although useful, has limited applicability (because of the restrictions outlined above). I do sometimes store the state of the process in a domain entity, but with a twist: we use NServiceBus Sagas to implement some of our entities.</p>
<p>Here are some useful resources:</p>
<ul>
<li><a href="https://lostechies.com/jimmybogard/2013/04/26/saga-alternatives-routing-slips/" target="_blank" rel="noopener">Saga alternatives – routing slips by Jimmy Bogard</a></li>
<li>
<a href="https://blog.bernd-ruecker.com/what-are-long-running-processes-b3ee769f0a27" target="_blank" rel="noopener">What are long running processes?</a> by <a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker" dir="auto" href="https://blog.bernd-ruecker.com/@berndruecker?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="41646ef41593" data-action-type="hover" data-user-id="41646ef41593" data-collection-slug="berndruecker">Bernd Rücker</a>
</li>
</ul>
<p>In the next article we&#8217;ll go over some patterns for handling failure.</p>

<div id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>		
	</div>

	<footer class="entry-footer">

					<span class="tag-links" itemprop="keywords">
									<a href="./../tag/integration/index.html"><span>#</span>integration</a>
									<a href="./../tag/long-running-process/index.html"><span>#</span>long running process</a>
									<a href="./../tag/messaging/index.html"><span>#</span>messaging</a>
									<a href="./../tag/microservices/index.html"><span>#</span>microservices</a>
									<a href="./../tag/nservicebus/index.html"><span>#</span>NServiceBus</a>
									<a href="./../tag/process-manager/index.html"><span>#</span>process manager</a>
									<a href="./../tag/routing-slip/index.html"><span>#</span>routing slip</a>
									<a href="./../tag/soa/index.html"><span>#</span>soa</a>
							</span>
		
	</footer>

	<div class="jetpack-share-like">
					</div>

</article><!-- #post-## -->

				
	<div class="author-bio" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
		<img alt="Victor Chircu" src="https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=80&#038;d=mm&#038;r=g" srcset="https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=160&#038;d=mm&#038;r=g 2x" class="avatar avatar-80 photo" height="80" width="80" loading="lazy" decoding="async" itemprop="image">		<div class="description">
			<h3 class="author-title name">
				<a class="author-name url fn n" href="./../author/victor-chircugmail-com/index.html" rel="author" itemprop="url"><span itemprop="name">Victor Chircu</span></a>
			</h3>
			<p class="bio" itemprop="description">I'm a software architect and continuous learner. I like solving real, challenging problems and sharing experiences with other people.</p>
			<ul class="author-social">
									<li class="website">
						<a href="./../index.html"><i class="fa fa-home"></i></a>
					</li>
													<li class="twitter">
						<a href="https://twitter.com/victorchircu/"><i class="fa fa-twitter"></i></a>
					</li>
																									<li class="linkedin">
						<a href="https://www.linkedin.com/in/victor-chircu-1519a331"><i class="fa fa-linkedin"></i></a>
					</li>
							</ul>
		</div>
	</div>
<!-- .author-bio -->


				
		<div class="related-posts">
			<h3>Related Posts</h3>
			<ul>
									<li>
												<h2 class="entry-title"><a href="./../interviewing-your-architecture/index.html" rel="bookmark">Interviewing your architecture</a></h2>						<time class="published" datetime="2020-02-28T09:49:27+00:00">February 28, 2020</time>
					</li>
									<li>
												<h2 class="entry-title"><a href="./../nservicebus-an-experience-report/index.html" rel="bookmark">NServiceBus: An Experience Report</a></h2>						<time class="published" datetime="2019-08-30T14:56:30+00:00">August 30, 2019</time>
					</li>
									<li>
												<h2 class="entry-title"><a href="./../handling-failure-in-long-running-processes/index.html" rel="bookmark">Handling Failure in Long Running Processes</a></h2>						<time class="published" datetime="2019-07-13T09:41:39+00:00">July 13, 2019</time>
					</li>
							</ul>
		</div>

	
				
				
	<div class="loop-nav">
		<div class="prev">Previous: <a href="./../modelling-long-running-processes-choreography-versus-orchestration/index.html" rel="prev">Modelling Long Running Processes: Choreography versus Orchestration</a>
</div>		<div class="next">Next: <a href="./../what-ive-learned-on-the-crafted-code-course/index.html" rel="next">What I&#8217;ve learned on the Crafted Code course</a>
</div>	</div>
<!-- .loop-nav -->


			
		</main><!-- #main -->
	</div>
<!-- #primary -->


<div id="secondary" class="widget-area" role="complementary" aria-label="Primary Sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
	<aside id="search-4" class="widget widget_search"><form role="search" method="get" class="searchform" action=".//">
	<div>
		<input type="search" class="search-field field" placeholder="Press enter to search &hellip;" value="" name="s" title="Search for:">
	</div>
</form>
</aside>
		<aside id="recent-posts-4" class="widget widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="./../how-to-identify-common-code-smells-using-the-ndepend-api/index.html">How to identify common Code Smells using the NDepend API</a>
									</li>
											<li>
					<a href="./../interviewing-your-architecture/index.html">Interviewing your architecture</a>
									</li>
											<li>
					<a href="./../nservicebus-an-experience-report/index.html">NServiceBus: An Experience Report</a>
									</li>
											<li>
					<a href="./../handling-failure-in-long-running-processes/index.html">Handling Failure in Long Running Processes</a>
									</li>
											<li>
					<a href="./../7-strategies-for-assigning-ids/index.html">7 Strategies for Assigning Ids</a>
									</li>
					</ul>

		</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">Tags</h3>
<div class="tagcloud">
<a href="./../tag/agile/index.html" class="tag-cloud-link tag-link-29 tag-link-position-1" style="font-size: 12px;">agile</a>
<a href="./../tag/architecture/index.html" class="tag-cloud-link tag-link-33 tag-link-position-2" style="font-size: 12px;">architecture</a>
<a href="./../tag/books/index.html" class="tag-cloud-link tag-link-14 tag-link-position-3" style="font-size: 12px;">books</a>
<a href="./../tag/code-smells/index.html" class="tag-cloud-link tag-link-65 tag-link-position-4" style="font-size: 12px;">code smells</a>
<a href="./../tag/ddd/index.html" class="tag-cloud-link tag-link-28 tag-link-position-5" style="font-size: 12px;">ddd</a>
<a href="./../tag/detection-strategy/index.html" class="tag-cloud-link tag-link-67 tag-link-position-6" style="font-size: 12px;">detection strategy</a>
<a href="./../tag/integration/index.html" class="tag-cloud-link tag-link-9 tag-link-position-7" style="font-size: 12px;">integration</a>
<a href="./../tag/long-running-process/index.html" class="tag-cloud-link tag-link-93 tag-link-position-8" style="font-size: 12px;">long running process</a>
<a href="./../tag/messaging/index.html" class="tag-cloud-link tag-link-10 tag-link-position-9" style="font-size: 12px;">messaging</a>
<a href="./../tag/metrics/index.html" class="tag-cloud-link tag-link-60 tag-link-position-10" style="font-size: 12px;">metrics</a>
<a href="./../tag/microservices/index.html" class="tag-cloud-link tag-link-87 tag-link-position-11" style="font-size: 12px;">microservices</a>
<a href="./../tag/msmq/index.html" class="tag-cloud-link tag-link-48 tag-link-position-12" style="font-size: 12px;">msmq</a>
<a href="./../tag/ndepend/index.html" class="tag-cloud-link tag-link-51 tag-link-position-13" style="font-size: 12px;">NDepend</a>
<a href="./../tag/nservicebus/index.html" class="tag-cloud-link tag-link-8 tag-link-position-14" style="font-size: 12px;">NServiceBus</a>
<a href="./../tag/quality/index.html" class="tag-cloud-link tag-link-24 tag-link-position-15" style="font-size: 12px;">quality</a>
<a href="./../tag/security/index.html" class="tag-cloud-link tag-link-4 tag-link-position-16" style="font-size: 12px;">security</a>
<a href="./../tag/soa/index.html" class="tag-cloud-link tag-link-37 tag-link-position-17" style="font-size: 12px;">soa</a>
<a href="./../tag/specifications/index.html" class="tag-cloud-link tag-link-19 tag-link-position-18" style="font-size: 12px;">specifications</a>
<a href="./../tag/testing/index.html" class="tag-cloud-link tag-link-12 tag-link-position-19" style="font-size: 12px;">testing</a>
<a href="./../tag/visualization/index.html" class="tag-cloud-link tag-link-63 tag-link-position-20" style="font-size: 12px;">visualization</a>
</div>
</aside><aside id="archives-6" class="widget widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href="./../2020/03/index.html">March 2020</a></li>
	<li><a href="./../2020/02/index.html">February 2020</a></li>
	<li><a href="./../2019/08/index.html">August 2019</a></li>
	<li><a href="./../2019/07/index.html">July 2019</a></li>
	<li><a href="./../2019/06/index.html">June 2019</a></li>
	<li><a href="./../2019/04/index.html">April 2019</a></li>
	<li><a href="./../2019/03/index.html">March 2019</a></li>
	<li><a href="./../2019/02/index.html">February 2019</a></li>
	<li><a href="./../2019/01/index.html">January 2019</a></li>
	<li><a href="./../2018/10/index.html">October 2018</a></li>
	<li><a href="./../2018/07/index.html">July 2018</a></li>
	<li><a href="./../2018/06/index.html">June 2018</a></li>
	<li><a href="./../2018/02/index.html">February 2018</a></li>
	<li><a href="./../2017/01/index.html">January 2017</a></li>
	<li><a href="./../2016/12/index.html">December 2016</a></li>
	<li><a href="./../2016/11/index.html">November 2016</a></li>
	<li><a href="./../2016/10/index.html">October 2016</a></li>
	<li><a href="./../2016/09/index.html">September 2016</a></li>
	<li><a href="./../2016/08/index.html">August 2016</a></li>
	<li><a href="./../2016/07/index.html">July 2016</a></li>
	<li><a href="./../2016/06/index.html">June 2016</a></li>
	<li><a href="./../2016/05/index.html">May 2016</a></li>
	<li><a href="./../2016/04/index.html">April 2016</a></li>
	<li><a href="./../2016/03/index.html">March 2016</a></li>
			</ul>

			</aside><aside id="rss_links-3" class="widget widget_rss_links"><ul><li><a target="_self" href="./../feed/index.html" title="Subscribe to posts">RSS - Posts</a></li></ul>
</aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" class="searchform" action=".//">
	<div>
		<input type="search" class="search-field field" placeholder="Press enter to search &hellip;" value="" name="s" title="Search for:">
	</div>
</form>
</aside>
		<aside id="recent-posts-2" class="widget widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="./../how-to-identify-common-code-smells-using-the-ndepend-api/index.html">How to identify common Code Smells using the NDepend API</a>
									</li>
											<li>
					<a href="./../interviewing-your-architecture/index.html">Interviewing your architecture</a>
									</li>
											<li>
					<a href="./../nservicebus-an-experience-report/index.html">NServiceBus: An Experience Report</a>
									</li>
											<li>
					<a href="./../handling-failure-in-long-running-processes/index.html">Handling Failure in Long Running Processes</a>
									</li>
											<li>
					<a href="./../7-strategies-for-assigning-ids/index.html">7 Strategies for Assigning Ids</a>
									</li>
					</ul>

		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h3 class="widget-title">Recent Comments</h3>
<ul id="recentcomments">
<li class="recentcomments">
<span class="comment-author-link"><a href="https://codetheweb.blog/" class="url" rel="ugc external nofollow">Booligoosh</a></span> on <a href="./../why-i-started-blogging/index.html#comment-58">Why I started blogging</a>
</li>
<li class="recentcomments">
<span class="comment-author-link"><a href="./../index.html" class="url" rel="ugc">Victor</a></span> on <a href="./../overview-pyramid-metrics-ndepend/index.html#comment-57">Computing the Overview Pyramid metrics with NDepend</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">Geoffrey</span> on <a href="./../overview-pyramid-metrics-ndepend/index.html#comment-56">Computing the Overview Pyramid metrics with NDepend</a>
</li>
<li class="recentcomments">
<span class="comment-author-link"><a href="./../index.html" class="url" rel="ugc">Victor</a></span> on <a href="./../book-review-object-oriented-metrics-in-practice/index.html#comment-55">Book Review: Object-Oriented Metrics in Practice</a>
</li>
<li class="recentcomments">
<span class="comment-author-link">pschwarz</span> on <a href="./../book-review-object-oriented-metrics-in-practice/index.html#comment-54">Book Review: Object-Oriented Metrics in Practice</a>
</li>
</ul></aside><aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href="./../2020/03/index.html">March 2020</a></li>
	<li><a href="./../2020/02/index.html">February 2020</a></li>
	<li><a href="./../2019/08/index.html">August 2019</a></li>
	<li><a href="./../2019/07/index.html">July 2019</a></li>
	<li><a href="./../2019/06/index.html">June 2019</a></li>
	<li><a href="./../2019/04/index.html">April 2019</a></li>
	<li><a href="./../2019/03/index.html">March 2019</a></li>
	<li><a href="./../2019/02/index.html">February 2019</a></li>
	<li><a href="./../2019/01/index.html">January 2019</a></li>
	<li><a href="./../2018/10/index.html">October 2018</a></li>
	<li><a href="./../2018/07/index.html">July 2018</a></li>
	<li><a href="./../2018/06/index.html">June 2018</a></li>
	<li><a href="./../2018/02/index.html">February 2018</a></li>
	<li><a href="./../2017/01/index.html">January 2017</a></li>
	<li><a href="./../2016/12/index.html">December 2016</a></li>
	<li><a href="./../2016/11/index.html">November 2016</a></li>
	<li><a href="./../2016/10/index.html">October 2016</a></li>
	<li><a href="./../2016/09/index.html">September 2016</a></li>
	<li><a href="./../2016/08/index.html">August 2016</a></li>
	<li><a href="./../2016/07/index.html">July 2016</a></li>
	<li><a href="./../2016/06/index.html">June 2016</a></li>
	<li><a href="./../2016/05/index.html">May 2016</a></li>
	<li><a href="./../2016/04/index.html">April 2016</a></li>
	<li><a href="./../2016/03/index.html">March 2016</a></li>
			</ul>

			</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">Categories</h3>
			<ul>
					<li class="cat-item cat-item-86">
<a href="./../category/architecture/index.html">Architecture</a>
</li>
	<li class="cat-item cat-item-2">
<a href="./../category/books/index.html">Books</a>
</li>
	<li class="cat-item cat-item-23">
<a href="./../category/clean-code/index.html">Clean Code</a>
</li>
	<li class="cat-item cat-item-49">
<a href="./../category/msmq/index.html">MSMQ</a>
</li>
	<li class="cat-item cat-item-38">
<a href="./../category/nservicebus/index.html">NServiceBus</a>
</li>
	<li class="cat-item cat-item-103">
<a href="./../category/process/index.html">Process</a>
</li>
	<li class="cat-item cat-item-27">
<a href="./../category/quality/index.html">Quality</a>
</li>
	<li class="cat-item cat-item-90">
<a href="./../category/quirks/index.html">Quirks</a>
</li>
	<li class="cat-item cat-item-3">
<a href="./../category/security/index.html">Security</a>
</li>
	<li class="cat-item cat-item-81">
<a href="./../category/soft-skills/index.html">Soft Skills</a>
</li>
	<li class="cat-item cat-item-36">
<a href="./../category/specification-by-example/index.html">Specification by Example</a>
</li>
	<li class="cat-item cat-item-1">
<a href="./../category/uncategorized/index.html">Uncategorized</a>
</li>
			</ul>

			</aside><aside id="meta-2" class="widget widget_meta"><h3 class="widget-title">Meta</h3>
		<ul>
						<li><a href="./../wp-login.php">Log in</a></li>
			<li><a href="./../feed/index.html">Entries feed</a></li>
			<li><a href="./../comments/feed/index.html">Comments feed</a></li>

			<li><a href="https://wordpress.org/">WordPress.org</a></li>
		</ul>

		</aside>
</div>
<!-- #secondary -->
		</div>
<!-- .wide-container -->
	</div>
<!-- #content -->

	
	<footer id="colophon" class="site-footer" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
		<div class="wide-container">

			<div class="site-info">
				<p class="copyright">&copy; Copyright 2024 <a href="./../index.html">Simple Oriented Architecture</a> &middot; Designed by <a href="http://www.theme-junkie.com/">Theme Junkie</a></p>			</div>
<!-- .site-info -->

			<div class="social-links">
<a href="https://twitter.com/victorchircu/"><i class="fa fa-twitter"></i></a><a href="https://www.linkedin.com/in/victor-chircu-1519a331"><i class="fa fa-linkedin"></i></a>
</div>
		</div>
	</footer><!-- #colophon -->

</div>
<!-- #page -->

	<div style="display:none">
			<div class="grofile-hash-map-331148ee28fef6336a73beb488fc0bdc">
		</div>
		</div>
		<script type="text/javascript" src="./../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b" id="syntaxhighlighter-core-js"></script>
<script type="text/javascript" src="./../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.9b" id="syntaxhighlighter-brush-csharp-js"></script>
<script type="text/javascript">(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = ".//wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.head.appendChild( corecss );
		var themecssurl = ".//wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.head.appendChild( themecss );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}</script>
<script type="text/javascript" src="./../wp-content/themes/bulan/assets/js/bulan.min.js" id="bulan-scripts-js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202445.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"108420443\",\"post\":\"907\",\"tz\":\"0\",\"srv\":\"www.simpleorientedarchitecture.com\",\"j\":\"1:14.0\"}") ]);
_stq.push([ "clickTrackerInit", "108420443", "907" ]);
/* ]]> */
</script>

</body>
</html>