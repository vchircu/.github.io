<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="./../xmlrpc.php">

<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

	<!-- This site is optimized with the Yoast SEO plugin v23.8 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Saga concurrency and coarse-grained locks when using NHibernate Persistence - Simple Oriented Architecture</title>
	<meta name="description" content="NHibernate does not support coarse-grained locking. This article discusses one possible solution for ensuring NSercieBus Saga concurrency in this case.">
	<link rel="canonical" href="./index.html">
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Saga concurrency and coarse-grained locks when using NHibernate Persistence - Simple Oriented Architecture">
	<meta property="og:description" content="NHibernate does not support coarse-grained locking. This article discusses one possible solution for ensuring NSercieBus Saga concurrency in this case.">
	<meta property="og:url" content="./index.html">
	<meta property="og:site_name" content="Simple Oriented Architecture">
	<meta property="article:published_time" content="2016-08-14T12:46:49+00:00">
	<meta property="article:modified_time" content="2016-09-21T11:40:06+00:00">
	<meta name="author" content="Victor Chircu">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:creator" content="@https://twitter.com/victorchircu/">
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Victor Chircu">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="9 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":".//saga-concurrency-coarse-grained-locks-nhibernate/#article","isPartOf":{"@id":".//saga-concurrency-coarse-grained-locks-nhibernate/"},"author":{"name":"Victor Chircu","@id":".//#/schema/person/14f18e400f12db819869e684790bbf7e"},"headline":"Saga concurrency and coarse-grained locks when using NHibernate Persistence","datePublished":"2016-08-14T12:46:49+00:00","dateModified":"2016-09-21T11:40:06+00:00","mainEntityOfPage":{"@id":".//saga-concurrency-coarse-grained-locks-nhibernate/"},"wordCount":1894,"commentCount":0,"publisher":{"@id":".//#/schema/person/14f18e400f12db819869e684790bbf7e"},"keywords":["aggregate","concurrency","ddd","NHibernate","NServiceBus","Saga"],"articleSection":["NServiceBus"],"inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":[".//saga-concurrency-coarse-grained-locks-nhibernate/#respond"]}]},{"@type":"WebPage","@id":".//saga-concurrency-coarse-grained-locks-nhibernate/","url":".//saga-concurrency-coarse-grained-locks-nhibernate/","name":"Saga concurrency and coarse-grained locks when using NHibernate Persistence - Simple Oriented Architecture","isPartOf":{"@id":".//#website"},"datePublished":"2016-08-14T12:46:49+00:00","dateModified":"2016-09-21T11:40:06+00:00","description":"NHibernate does not support coarse-grained locking. This article discusses one possible solution for ensuring NSercieBus Saga concurrency in this case.","breadcrumb":{"@id":".//saga-concurrency-coarse-grained-locks-nhibernate/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":[".//saga-concurrency-coarse-grained-locks-nhibernate/"]}]},{"@type":"BreadcrumbList","@id":".//saga-concurrency-coarse-grained-locks-nhibernate/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":".//"},{"@type":"ListItem","position":2,"name":"Saga concurrency and coarse-grained locks when using NHibernate Persistence"}]},{"@type":"WebSite","@id":".//#website","url":".//","name":"Simple Oriented Architecture","description":"","publisher":{"@id":".//#/schema/person/14f18e400f12db819869e684790bbf7e"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":".//?s={search_term_string}"},"query-input":{"@type":"PropertyValueSpecification","valueRequired":true,"valueName":"search_term_string"}}],"inLanguage":"en-US"},{"@type":["Person","Organization"],"@id":".//#/schema/person/14f18e400f12db819869e684790bbf7e","name":"Victor Chircu","image":{"@type":"ImageObject","inLanguage":"en-US","@id":".//#/schema/person/image/","url":"https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=96&d=mm&r=g","contentUrl":"https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=96&d=mm&r=g","caption":"Victor Chircu"},"logo":{"@id":".//#/schema/person/image/"},"description":"I'm a software architect and continuous learner. I like solving real, challenging problems and sharing experiences with other people.","sameAs":[".//","https://www.linkedin.com/in/victor-chircu-1519a331","https://x.com/https://twitter.com/victorchircu/"]}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//stats.wp.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//v0.wordpress.com">
<link rel="dns-prefetch" href="//i0.wp.com">
<link rel="alternate" type="application/rss+xml" title="Simple Oriented Architecture &raquo; Feed" href="./../feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Simple Oriented Architecture &raquo; Comments Feed" href="./../comments/feed/index.html">
<link rel="alternate" type="application/rss+xml" title="Simple Oriented Architecture &raquo; Saga concurrency and coarse-grained locks when using NHibernate Persistence Comments Feed" href="./feed/index.html">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":".\/\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🐦‍⬛","🐦​⬛")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="./../wp-content/plugins/jetpack/modules/related-posts/related-posts.css?ver=20240116" type="text/css" media="all">
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="./../wp-includes/css/dist/block-library/style.min.css?ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="mediaelement-css" href="./../wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./../wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.6.2" type="text/css" media="all">
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}</style>
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="bulan-plugins-style-css" href="./../wp-content/themes/bulan/assets/css/plugins.min.css?ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="bulan-fonts-css" href="https://fonts.googleapis.com/css?family=Crimson+Text%3A400%2C700%2C400italic%257COswald%3A400%2C700%2C300&#038;subset=latin%2Clatin-ext&#038;ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="bulan-style-css" href="./../wp-content/themes/bulan/style.min.css?ver=6.6.2" type="text/css" media="all">
<link rel="stylesheet" id="eu-cookie-law-style-css" href="./../wp-content/plugins/jetpack/modules/widgets/eu-cookie-law/style.css?ver=14.0" type="text/css" media="all">
<link rel="stylesheet" id="sharedaddy-css" href="./../wp-content/plugins/jetpack/modules/sharedaddy/sharing.css?ver=14.0" type="text/css" media="all">
<link rel="stylesheet" id="social-logos-css" href="./../wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=14.0" type="text/css" media="all">
<script type="text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="text/javascript" src="./../wp-content/plugins/jetpack/_inc/build/related-posts/related-posts.min.js?ver=20240116" id="jetpack_related-posts-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="./../wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<!--[if lte IE 9]>
<script type="text/javascript" src=".//wp-content/themes/bulan/assets/js/html5shiv.min.js" id="standard-html5-js"></script>
<![endif]-->
<link rel="https://api.w.org/" href="./../wp-json/index.html">
<link rel="alternate" title="JSON" type="application/json" href="./../wp-json/wp/v2/posts/295/index.html">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="./../xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.6.2">
<link rel="shortlink" href="https://wp.me/p7kV6P-4L">
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="./../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Fsaga-concurrency-coarse-grained-locks-nhibernate%2F">
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="./../wp-json/oembed/1.0/embed/index.html?url=https%3A%2F%2F%2Fsaga-concurrency-coarse-grained-locks-nhibernate%2F#038;format=xml">
	<style>img#wpstats{display:none}</style>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>

<body class="post-template-default single single-post postid-295 single-format-standard no-custom-header no-featured-image layout-2c-l" itemscope itemtype="http://schema.org/Blog">

<div id="page" class="site">

	<div class="search-area">
		<div class="wide-container">
			<form role="search" method="get" class="searchform" action=".//">
	<div>
		<input type="search" class="search-field field" placeholder="Press enter to search &hellip;" value="" name="s" title="Search for:">
	</div>
</form>
		</div>
	</div>

	
	<header id="masthead" class="site-header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">

		<div class="site-branding">
			<div class="wide-container">
				<div id="logo">
<h1 class="site-title" itemprop="headline"><a href="./../index.html" itemprop="url" rel="home"><span itemprop="headline">Simple Oriented Architecture</span></a></h1>
</div>
			</div>
		</div>

	</header><!-- #masthead -->

	<div id="content" class="site-content">
		<div class="wide-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main">

			
				<article id="post-295" class="post-295 post type-post status-publish format-standard hentry category-nservicebus tag-aggregate tag-concurrency tag-ddd tag-nhibernate tag-nservicebus tag-saga no-post-thumbnail no-sticky entry" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">

	<header class="entry-header">

								<span class="cat-links" itemprop="articleSection">
				<a href="./../category/nservicebus/index.html" rel="category tag">NServiceBus</a>			</span>
			<i class="fa fa-circle"></i>
					
					<time class="published" datetime="2016-08-14T12:46:49+00:00" itemprop="datePublished">August 14, 2016</time>
		
		<h1 class="entry-title" itemprop="headline">Saga concurrency and coarse-grained locks when using NHibernate Persistence</h1>
	</header><!-- .entry-header -->

	
	<div class="entry-content" itemprop="articleBody">

		<p>Recently, I stumbled upon an interesting problem related to NServiceBus Saga concurrency and coarse-grained locks when using NHibernate Persistence.</p>
<p>With NServiceBus, <a href="http://docs.particular.net/nservicebus/sagas/concurrency#concurrent-access-to-existing-saga-instances" target="_blank">concurrent access to an existing saga instance</a> works out of the box. This is because it relies on the underlying database system. With NHibernate, it relies on optimistic concurrency, by <a href="https://ayende.com/blog/3946/nhibernate-mapping-concurrency" target="_blank">adding a Version column</a> to your Saga Data. But there is a catch: NHibernate doesn&#8217;t support<a href="http://martinfowler.com/eaaCatalog/coarseGrainedLock.html" target="_blank"> Coarse-Grained Locks</a>. Let&#8217;s first explore this general problem and then we&#8217;ll get back to the NServiceBus Saga.</p>
<h3>Coarse-Grained Locks</h3>
<p>With a coarse-grained lock you basically lock a group of entities together. If you&#8217;re familiar with DDD, then you know that an aggregate should be a <a href="https://lostechies.com/jimmybogard/2010/02/04/strengthening-your-domain-a-primer/" target="_blank">consistency boundary</a>. When I save an aggregate, I want to save the <strong><em>entire</em> </strong>aggregate, to ensure it&#8217;s consistent. Why would you need this? Here&#8217;s an example:</p>
<p>Let&#8217;s take the already familiar example of an <strong>Order</strong> with <strong>OrderLines</strong>, Order being the aggregate root. We&#8217;re using optimistic concurrency control for each of our aggregate parts. In our domain there is an invariant that dictates that the <em>total number of items  in an order can&#8217;t be more than 10</em>. Two commands that would increase the quantity could be processed in parallel and break the invariant. This is because in each transaction, the invariant would hold and each transaction would commit, since they update different lines. Now you&#8217;re in an inconsistent state.</p>
<p>If we could lock the entire aggregate (order and order lines), then the second transaction would fail and rollback, maintaining a consistent state. One way to achieve this when using optimistic concurrency is to update the root&#8217;s version whenever an aggregate part is updated.</p>
<p><span id="more-295"></span></p>
<h3>Use Listeners to lock the root</h3>
<p>There are <a href="http://colinjack.blogspot.ro/2007/05/nhibernate-and-coarse-grained-locking.html" target="_blank">some posts</a>, <a href="http://stackoverflow.com/questions/37961956/nhibernate-not-detecting-changes-to-parent-when-child-collection-updates" target="_blank">stackoverflow </a><a href="http://stackoverflow.com/questions/8308586/version-does-not-increment-when-updating-child-item" target="_blank">questions</a> and <a href="https://groups.google.com/forum/#!topic/nhusers/sdzffWFtDnc" target="_blank">forum threads</a> on how to update the parent&#8217;s version when a child is modified. Even though most of them are pretty old, there is no definitive answer. <a href="https://ayende.com/blog" target="_blank">Ayende Rahien</a> proposes probably the most well known solution to this problem. He discusses it in a couple of blog posts. The first touches on how you could <a href="https://ayende.com/blog/4040/nhibernate-coarse-grained-locks" target="_blank">lock the aggregate root</a>:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
session.Lock(aggregateRoot, LockMode.Force);
</pre>
<p>This basically forces a version increment for versioned entities. The questions is: how do you know when to call this? One option could be to have a coding guideline to increment the version every time you load an aggregate for updating. The problem is that you can get some nasty bugs if you forget to call this. <a href="https://ayende.com/blog/4055/nhibernate-automatic-change-tracking-for-aggregate-roots-in-ddd-scenarios" target="_blank">The second post</a> tackles this problem. The proposed solution uses <a href="http://nhibernate.info/doc/nhibernate-reference/events.html" target="_blank">NHibernate event listners</a> and on every aggregate part update, finds the aggregate root and forces a version increment.</p>
<p>The blog post also notes the constraints of this approach. Two of them are inherent to DDD: <em>the relation between aggregates and contained entities must be explicit</em> and you <em>access an aggregate part only by traversing from the root</em>.</p>
<p>The third however is more restrictive in my view. It dictates that<strong> <em>you need to have a direct reference from the aggregate part to the aggregate root</em></strong>. Since the aggregate root needs to know its parts, this basically means that we need to have bidirectional associations across the entire aggregate for this to work. I prefer to use a single traversal direction if possible. Even more, a direct reference means you need to add a reference to the aggregate root, even if it&#8217;s not the direct parent of the entity:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public interface IAggregateRoot
{
}

public interface IAggregatePart
{
    IAggregateRoot Root { get; }
}
</pre>
<p>So it seems that there isn&#8217;t a general solution to the coarse-grained locking problem in NHibernate. You need to solve it by either:</p>
<ul>
<li>making it explicit in your domain logic
<ul>
<li>update a property on the root every time you update an aggregate part</li>
<li>have a special method for loading an aggregate for writes</li>
</ul>
</li>
<li>add extra relations in your domain to be able to traverse from the aggregate part to the aggregate root</li>
</ul>
<p>But, the truth is, I don&#8217;t need a general solution. I need to solve the problem of NServiceBus Saga concurrency and coarse-grained locks when using NHibernate Persistence.</p>
<h2>NServiceBus Saga concurrency and coarse-grained locks when using NHibernate Persistence</h2>
<p>Fortunately, in my case, the problem was a bit simpler and more specific. I have a Process Manager which, when started, sends a small number of requests to some other components to do some tasks. Since these tasks might take some time, I send them all at once, so they can be processed in parallel. When I get a response back, I mark the task as completed and check if all tasks have been processed. (This is a simplified version, I actually need to send other messages and have multiple task types).</p>
<p>This is the saga data:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public class SagaData : IContainSagaData
{
    public int Version { get; set; }

    public List&lt;LongRunningTask&gt; Tasks { get; set; }

    public Guid Id { get; set; }

    public string Originator { get; set; }

    public string OriginalMessageId { get; set; }
}

public class LongRunningTask
{
    public Guid Id { get; set; }

    public Status Status { get; set; }

    public string Result { get; set; }
}

public enum Status
{
    InProgress, 
    Completed
}
</pre>
<p>And here is the saga code:</p>
<pre class="brush: csharp; highlight: [31]; title: ; notranslate" title="">
public class Saga : Saga&lt;SagaData&gt;,
                    IAmStartedByMessages&lt;StartSagaCommand&gt;,
                    IHandleMessages&lt;DoTaskResponse&gt;
{
    public void Handle(StartSagaCommand message)
    {
        Data.Tasks = new List&lt;LongRunningTask&gt;();
        foreach (var tasks in message.Tasks)
        {
            var newTask = new LongRunningTask
            {
                Status = Status.InProgress
            };
            Data.Tasks.Add(newTask);

            var doTaskRequest = new DoTaskRequest
            {
                TaskId = newTask.Id
            };
            Bus.Send(doTaskRequest);
        }
    }

    public void Handle(DoTaskResponse message)
    {
        var task = Data.Tasks.Single(t =&gt; t.Id == message.TaskId);

        task.Status = Status.Completed;
        task.Result = message.Result;

        if (Data.Tasks.All(t =&gt; t.Status == Status.Completed))
        {
            Bus.Send(new DoSomeOtherStuffCommand(Data));
            MarkAsComplete();
        }
    }
}
</pre>
<p>The question is: what happens if we process the last two task responses concurrently? The completion condition highlighted above will be false for both messages. But since the <strong>DoTaskResponse</strong> handler doesn&#8217;t update the saga data (the parent), just the task (the child), will both transactions commit? If this is the case, then this saga instance will never send the <strong>DoSomeOtherStuffCommand</strong>.</p>
<h3>Pessimistic locking of the saga instance</h3>
<p>The good news is that <strong>you won&#8217;t have this problem if you use the default settings</strong>. This is because<a href="http://docs.particular.net/nservicebus/nhibernate/saga-concurrency#default-behavior" target="_blank"> since Version 4.1.0, the NHibernate saga persister uses an additional pessimistic concurrency control</a>. This means that it puts a lock on the saga data when it fetches it. Processing the second message will have to wait until the first transaction commits. <strong>So if you don&#8217;t adjust the lock strategy to Read, you should be OK</strong>. Thus, the additional pessimistic lock would ensure consistency, even if the optimistic lock fails to update the parent&#8217;s version on a child update. </p>
<h3>Force a version upgrade on the Saga Data</h3>
<p>I was still wondering if there is a simple way to get the optimistic lock control to work like I wanted. One option would be to always force a version upgrade when handling a message. This isn&#8217;t an ideal solution if you&#8217;re handling messages that don&#8217;t update the saga data. Since in my case I do modify the saga data whenever I&#8217;m processing a message, this approach is OK.</p>
<p>The NServiceBus framework always calls <strong>Save</strong> on the saga data class, so I hooked up in the Save event listener:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public class ForceVerionUpgradeOnSagaDataListner : ISaveOrUpdateEventListener
{
	public void OnSaveOrUpdate(SaveOrUpdateEvent @event)
	{
		if (@event.Entity is IContainSagaData &amp;&amp; !@event.Session.IsDirtyEntity(@event.Entity))
		{
			@event.Session.Lock(@event.Entity, LockMode.Force);
		}
	}
}
</pre>
<p>As you can see, I do this only for the parent saga data. Also, to prevent the multiple update per transaction issue that Ayende highlighted, I upgrade the version only if the saga data is not dirty. If it is dirty, it would be upgraded anyway.</p>
<h3>Checking if an entity is dirty</h3>
<p><strong>IsDirtyEntity</strong> is an extension method that checks if an entity has changed after it has been loaded into the session. My NHibernate skills are not good enough to implement such a method from scratch. I&#8217;ve searched for a way to do this and, to my surprise, I didn&#8217;t find a definitive answer. The first version I found is on <a href="http://nhibernate.info/doc/howto/various/finding-dirty-properties-in-nhibernate.html" target="_blank">NHibernate&#8217;s site</a> and does not work because of the following line:</p>
<pre class="brush: csharp; highlight: [2]; title: ; notranslate" title="">
Int32&#x5B;] dirtyProps = oldState
    .Select((o, i) =&gt; (oldState&#x5B;i] == currentState&#x5B;i]) ? -1 : i)
    .Where(x =&gt; x &gt;= 0)
    .ToArray();
</pre>
<p>If the property is a value type, this check will actually compare references to the boxed values, so it will always be false. The second version of this method is on <a href="http://www.nhforge.org/wikis/howtonh/finding-dirty-properties-in-nhibernate.aspx" target="_blank">nhforge</a> and replaces the line above with:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
Int32 &#x5B;] dirtyProps = persister.FindDirty(currentState, oldState, entity, sessionImpl);
</pre>
<p>This fixes the boxing issue, but has another caveat: it won&#8217;t detect changes (add/remove) to a collection. The third version, found on <a href="http://stackoverflow.com/questions/28006189/change-tracking-aggregate-root-in-ddd">stackoverflow </a>fixes this issue:</p>
<pre class="brush: csharp; highlight: [19,21]; title: ; notranslate" title="">
public static bool IsDirtyEntity(this ISession session, object entity)
{
	var sessionImplementation = session.GetSessionImplementation();
	var persistenceContext = sessionImplementation.PersistenceContext;
	var entityPersister = sessionImplementation.GetEntityPersister(null, entity);

	var entityEntry = persistenceContext.GetEntry(entity);

	if ((entityEntry == null) &amp;&amp; entity is INHibernateProxy)
	{
		var proxy = (INHibernateProxy)entity;
		var obj = sessionImplementation.PersistenceContext.Unproxy(proxy);
		entityEntry = sessionImplementation.PersistenceContext.GetEntry(obj);
	}

	object&#x5B;] oldState = entityEntry.LoadedState;
	object&#x5B;] currentState = entityPersister.GetPropertyValues(entity, sessionImplementation.EntityMode);

	int&#x5B;] findDirty = entityEntry.Persister.FindDirty(currentState, oldState, entity, sessionImplementation);

	var hasDirtyCollection = currentState.OfType&lt;IPersistentCollection&gt;().Any(x =&gt; x.IsDirty);

	return (findDirty != null) || hasDirtyCollection;
}
</pre>
<p>So this is the version I use. If you can spot any issue with it, please let me know.</p>
<h3>Registering the listener</h3>
<p>So the only thing left to do is to register the listener:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
nhConfiguration.AppendListeners(ListenerType.Update, new&#x5B;] { new ForceVerionUpgradeOnSagaDataListner() });
</pre>
<p>Now, the system will be consistent even if we don&#8217;t use the default pessimistic locking strategy and rely only on the optimistic locking control. If we process the last two responses in parallel, the first will commit (and update the version on the saga data). The second transaction will fail (with a <strong>StaleObjectStateException</strong>) and rollback. NServiceBus&#8217;s retry mechanism will ensure the message is retried and processed successfully. </p>
<p>As a note, there is no good reason to disable the pessimistic concurrency control. So you probably don&#8217;t need to force a version upgrade on the saga data.</p>
<h2>Conclusion</h2>
<p>I must admit, I assumed that NHibernate supports coarse-grained locking out of the box. I&#8217;m wondering how are people ensuring aggregate consistency when using NHibernate?</p>
<p>Fortunately, the problem I had was more specific, since it&#8217;s only about ensuring NServiceBus saga consistency when using NHibernate for persistence. So, in this particular case, the default pessimistic locking does its job, so no extra work is required. If you still want to update the saga data&#8217;s version on a child update, then you could force it.</p>
<p>Another solution would be to check for saga completion on a timeout, not when processing a message. Jimmy Bogard has a great blog post on <a href="https://lostechies.com/jimmybogard/2014/02/27/reducing-nservicebus-saga-load/" target="_blank">how to reduce NServiceBus saga load</a> by using this approach. This would actually be a better solution, if there was a big number of message. In my case, the number of tasks was limited, so I didn&#8217;t want to introduce the timeout.</p>
<p>If you can think of any other solution, please leave a comment. I&#8217;m definitely interested in seeing a better one!</p>

<div id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>		
	</div>

	<footer class="entry-footer">

					<span class="tag-links" itemprop="keywords">
									<a href="./../tag/aggregate/index.html"><span>#</span>aggregate</a>
									<a href="./../tag/concurrency/index.html"><span>#</span>concurrency</a>
									<a href="./../tag/ddd/index.html"><span>#</span>ddd</a>
									<a href="./../tag/nhibernate/index.html"><span>#</span>NHibernate</a>
									<a href="./../tag/nservicebus/index.html"><span>#</span>NServiceBus</a>
									<a href="./../tag/saga/index.html"><span>#</span>Saga</a>
							</span>
		
	</footer>

	<div class="jetpack-share-like">
		<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing">
<h3 class="sd-title">Share this:</h3>
<div class="sd-content"><ul>
<li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-295" class="share-facebook sd-button share-icon no-text" href="./index.html?share=facebook" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li>
<li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-295" class="share-twitter sd-button share-icon no-text" href="./index.html?share=twitter" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li>
<li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-295" class="share-linkedin sd-button share-icon no-text" href="./index.html?share=linkedin" target="_blank" title="Click to share on LinkedIn"><span></span><span class="sharing-screen-reader-text">Click to share on LinkedIn (Opens in new window)</span></a></li>
<li class="share-pocket"><a rel="nofollow noopener noreferrer" data-shared="" class="share-pocket sd-button share-icon no-text" href="./index.html?share=pocket" target="_blank" title="Click to share on Pocket"><span></span><span class="sharing-screen-reader-text">Click to share on Pocket (Opens in new window)</span></a></li>
<li class="share-end">
</ul></div>
</div></div>			</div>

</article><!-- #post-## -->

				
	<div class="author-bio" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
		<img alt="Victor Chircu" src="https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=80&#038;d=mm&#038;r=g" srcset="https://secure.gravatar.com/avatar/331148ee28fef6336a73beb488fc0bdc?s=160&#038;d=mm&#038;r=g 2x" class="avatar avatar-80 photo" height="80" width="80" decoding="async" itemprop="image">		<div class="description">
			<h3 class="author-title name">
				<a class="author-name url fn n" href="./../author/victor-chircugmail-com/index.html" rel="author" itemprop="url"><span itemprop="name">Victor Chircu</span></a>
			</h3>
			<p class="bio" itemprop="description">I'm a software architect and continuous learner. I like solving real, challenging problems and sharing experiences with other people.</p>
			<ul class="author-social">
									<li class="website">
						<a href="./../index.html"><i class="fa fa-home"></i></a>
					</li>
													<li class="twitter">
						<a href="https://twitter.com/victorchircu/"><i class="fa fa-twitter"></i></a>
					</li>
																									<li class="linkedin">
						<a href="https://www.linkedin.com/in/victor-chircu-1519a331"><i class="fa fa-linkedin"></i></a>
					</li>
							</ul>
		</div>
	</div>
<!-- .author-bio -->


				
		<div class="related-posts">
			<h3>Related Posts</h3>
			<ul>
									<li>
												<h2 class="entry-title"><a href="./../interviewing-your-architecture/index.html" rel="bookmark">Interviewing your architecture</a></h2>						<time class="published" datetime="2020-02-28T09:49:27+00:00">February 28, 2020</time>
					</li>
									<li>
												<h2 class="entry-title"><a href="./../nservicebus-an-experience-report/index.html" rel="bookmark">NServiceBus: An Experience Report</a></h2>						<time class="published" datetime="2019-08-30T14:56:30+00:00">August 30, 2019</time>
					</li>
									<li>
												<h2 class="entry-title"><a href="./../handling-failure-in-long-running-processes/index.html" rel="bookmark">Handling Failure in Long Running Processes</a></h2>						<time class="published" datetime="2019-07-13T09:41:39+00:00">July 13, 2019</time>
					</li>
							</ul>
		</div>

	
				
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="./index.html#respond" style="display:none;">Cancel reply</a></small>
</h3>
<form action=".//wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> <span class="required-field-message">Required fields are marked <span class="required">*</span></span></p>
<p class="comment-form-comment"><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true" placeholder="Comment"></textarea></p>
<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" autocomplete="name" required></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" autocomplete="email" required></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" autocomplete="url"></p>
<p class="comment-subscription-form"><input type="checkbox" name="subscribe_comments" id="subscribe_comments" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;"> <label class="subscribe-label" id="subscribe-label" for="subscribe_comments">Notify me of follow-up comments by email.</label></p>
<p class="comment-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;"> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog">Notify me of new posts by email.</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="295" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="8deda2e2f5"></p>
<p style="display: none !important;" class="akismet-fields-container" data-prefix="ak_"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="173"><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p>
</form>	</div>
<!-- #respond -->
	<p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div>
<!-- #comments -->

				
	<div class="loop-nav">
		<div class="prev">Previous: <a href="./../book-review-soft-skills/index.html" rel="prev">Book Review: Soft Skills</a>
</div>		<div class="next">Next: <a href="./../book-review-fifty-quick-ideas-to-improve-your-user-stories/index.html" rel="next">Book Review: Fifty Quick Ideas to Improve your User Stories</a>
</div>	</div>
<!-- .loop-nav -->


			
		</main><!-- #main -->
	</div>
<!-- #primary -->


<div id="secondary" class="widget-area" role="complementary" aria-label="Primary Sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
	<aside id="search-4" class="widget widget_search"><form role="search" method="get" class="searchform" action=".//">
	<div>
		<input type="search" class="search-field field" placeholder="Press enter to search &hellip;" value="" name="s" title="Search for:">
	</div>
</form>
</aside>
		<aside id="recent-posts-4" class="widget widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="./../how-to-identify-common-code-smells-using-the-ndepend-api/index.html">How to identify common Code Smells using the NDepend API</a>
									</li>
											<li>
					<a href="./../interviewing-your-architecture/index.html">Interviewing your architecture</a>
									</li>
											<li>
					<a href="./../nservicebus-an-experience-report/index.html">NServiceBus: An Experience Report</a>
									</li>
											<li>
					<a href="./../handling-failure-in-long-running-processes/index.html">Handling Failure in Long Running Processes</a>
									</li>
											<li>
					<a href="./../7-strategies-for-assigning-ids/index.html">7 Strategies for Assigning Ids</a>
									</li>
					</ul>

		</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">Tags</h3>
<div class="tagcloud">
<a href="./../tag/agile/index.html" class="tag-cloud-link tag-link-29 tag-link-position-1" style="font-size: 12px;">agile</a>
<a href="./../tag/architecture/index.html" class="tag-cloud-link tag-link-33 tag-link-position-2" style="font-size: 12px;">architecture</a>
<a href="./../tag/books/index.html" class="tag-cloud-link tag-link-14 tag-link-position-3" style="font-size: 12px;">books</a>
<a href="./../tag/code-smells/index.html" class="tag-cloud-link tag-link-65 tag-link-position-4" style="font-size: 12px;">code smells</a>
<a href="./../tag/ddd/index.html" class="tag-cloud-link tag-link-28 tag-link-position-5" style="font-size: 12px;">ddd</a>
<a href="./../tag/detection-strategy/index.html" class="tag-cloud-link tag-link-67 tag-link-position-6" style="font-size: 12px;">detection strategy</a>
<a href="./../tag/integration/index.html" class="tag-cloud-link tag-link-9 tag-link-position-7" style="font-size: 12px;">integration</a>
<a href="./../tag/long-running-process/index.html" class="tag-cloud-link tag-link-93 tag-link-position-8" style="font-size: 12px;">long running process</a>
<a href="./../tag/messaging/index.html" class="tag-cloud-link tag-link-10 tag-link-position-9" style="font-size: 12px;">messaging</a>
<a href="./../tag/metrics/index.html" class="tag-cloud-link tag-link-60 tag-link-position-10" style="font-size: 12px;">metrics</a>
<a href="./../tag/microservices/index.html" class="tag-cloud-link tag-link-87 tag-link-position-11" style="font-size: 12px;">microservices</a>
<a href="./../tag/msmq/index.html" class="tag-cloud-link tag-link-48 tag-link-position-12" style="font-size: 12px;">msmq</a>
<a href="./../tag/ndepend/index.html" class="tag-cloud-link tag-link-51 tag-link-position-13" style="font-size: 12px;">NDepend</a>
<a href="./../tag/nservicebus/index.html" class="tag-cloud-link tag-link-8 tag-link-position-14" style="font-size: 12px;">NServiceBus</a>
<a href="./../tag/quality/index.html" class="tag-cloud-link tag-link-24 tag-link-position-15" style="font-size: 12px;">quality</a>
<a href="./../tag/security/index.html" class="tag-cloud-link tag-link-4 tag-link-position-16" style="font-size: 12px;">security</a>
<a href="./../tag/soa/index.html" class="tag-cloud-link tag-link-37 tag-link-position-17" style="font-size: 12px;">soa</a>
<a href="./../tag/specifications/index.html" class="tag-cloud-link tag-link-19 tag-link-position-18" style="font-size: 12px;">specifications</a>
<a href="./../tag/testing/index.html" class="tag-cloud-link tag-link-12 tag-link-position-19" style="font-size: 12px;">testing</a>
<a href="./../tag/visualization/index.html" class="tag-cloud-link tag-link-63 tag-link-position-20" style="font-size: 12px;">visualization</a>
</div>
</aside><aside id="archives-6" class="widget widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href="./../2020/03/index.html">March 2020</a></li>
	<li><a href="./../2020/02/index.html">February 2020</a></li>
	<li><a href="./../2019/08/index.html">August 2019</a></li>
	<li><a href="./../2019/07/index.html">July 2019</a></li>
	<li><a href="./../2019/06/index.html">June 2019</a></li>
	<li><a href="./../2019/04/index.html">April 2019</a></li>
	<li><a href="./../2019/03/index.html">March 2019</a></li>
	<li><a href="./../2019/02/index.html">February 2019</a></li>
	<li><a href="./../2019/01/index.html">January 2019</a></li>
	<li><a href="./../2018/10/index.html">October 2018</a></li>
	<li><a href="./../2018/07/index.html">July 2018</a></li>
	<li><a href="./../2018/06/index.html">June 2018</a></li>
	<li><a href="./../2018/02/index.html">February 2018</a></li>
	<li><a href="./../2017/01/index.html">January 2017</a></li>
	<li><a href="./../2016/12/index.html">December 2016</a></li>
	<li><a href="./../2016/11/index.html">November 2016</a></li>
	<li><a href="./../2016/10/index.html">October 2016</a></li>
	<li><a href="./../2016/09/index.html">September 2016</a></li>
	<li><a href="./../2016/08/index.html">August 2016</a></li>
	<li><a href="./../2016/07/index.html">July 2016</a></li>
	<li><a href="./../2016/06/index.html">June 2016</a></li>
	<li><a href="./../2016/05/index.html">May 2016</a></li>
	<li><a href="./../2016/04/index.html">April 2016</a></li>
	<li><a href="./../2016/03/index.html">March 2016</a></li>
			</ul>

			</aside><aside id="rss_links-3" class="widget widget_rss_links"><ul><li><a target="_self" href="./../feed/index.html" title="Subscribe to posts">RSS - Posts</a></li></ul>
</aside><aside id="eu_cookie_law_widget-2" class="widget widget_eu_cookie_law_widget">
<div class="hide-on-button" data-hide-timeout="30" data-consent-expiration="180" id="eu-cookie-law">
	<form method="post" id="jetpack-eu-cookie-law-form">
		<input type="submit" value="Close and accept" class="accept">
	</form>

	Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br>
To find out more, including how to control cookies, see here:
		<a href="./../privacy-policy/index.html" rel="">
		Cookie Policy	</a>
</div>
</aside>
</div>
<!-- #secondary -->
		</div>
<!-- .wide-container -->
	</div>
<!-- #content -->

	
	<footer id="colophon" class="site-footer" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
		<div class="wide-container">

			<div class="site-info">
				<p class="copyright">&copy; Copyright 2024 <a href="./../index.html">Simple Oriented Architecture</a> &middot; Designed by <a href="http://www.theme-junkie.com/">Theme Junkie</a></p>			</div>
<!-- .site-info -->

			<div class="social-links">
<a href="https://twitter.com/victorchircu/"><i class="fa fa-twitter"></i></a><a href="https://www.linkedin.com/in/victor-chircu-1519a331"><i class="fa fa-linkedin"></i></a>
</div>
		</div>
	</footer><!-- #colophon -->

</div>
<!-- #page -->

	<div style="display:none">
			<div class="grofile-hash-map-331148ee28fef6336a73beb488fc0bdc">
		</div>
		</div>
		
	<script type="text/javascript">window.WPCOM_sharing_counts = {".\/\/saga-concurrency-coarse-grained-locks-nhibernate\/":295};</script>
				<script type="text/javascript" src="./../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b" id="syntaxhighlighter-core-js"></script>
<script type="text/javascript" src="./../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.9b" id="syntaxhighlighter-brush-csharp-js"></script>
<script type="text/javascript">(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = ".//wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.head.appendChild( corecss );
		var themecssurl = ".//wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.head.appendChild( themecss );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}</script>
<script type="text/javascript" src="./../wp-content/themes/bulan/assets/js/bulan.min.js" id="bulan-scripts-js"></script>
<script type="text/javascript" src="./../wp-includes/js/comment-reply.min.js?ver=6.6.2" id="comment-reply-js" async="async" data-wp-strategy="async"></script>
<script type="text/javascript" src="https://secure.gravatar.com/js/gprofiles.js?ver=202445" id="grofiles-cards-js"></script>
<script type="text/javascript" id="wpgroho-js-extra">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="./../wp-content/plugins/jetpack/modules/wpgroho.js?ver=14.0" id="wpgroho-js"></script>
<script type="text/javascript" src="./../wp-content/plugins/jetpack/_inc/build/widgets/eu-cookie-law/eu-cookie-law.min.js?ver=20180522" id="eu-cookie-law-script-js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202445.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"108420443\",\"post\":\"295\",\"tz\":\"0\",\"srv\":\"www.simpleorientedarchitecture.com\",\"j\":\"1:14.0\"}") ]);
_stq.push([ "clickTrackerInit", "108420443", "295" ]);
/* ]]> */
</script>
<script defer type="text/javascript" src="./../wp-content/plugins/akismet/_inc/akismet-frontend.js?ver=1720685985" id="akismet-frontend-js"></script>
<script type="text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./../wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=14.0" id="sharing-js-js"></script>
<script type="text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-pocket' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-pocket' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcompocket', 'menubar=1,resizable=1,width=450,height=450' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>

</body>
</html>